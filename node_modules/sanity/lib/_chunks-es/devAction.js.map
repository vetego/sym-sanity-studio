{"version":3,"file":"devAction.js","sources":["../../src/_internal/cli/actions/app/devAction.ts"],"sourcesContent":["import {type CliCommandArguments, type CliCommandContext} from '@sanity/cli'\nimport chalk from 'chalk'\nimport {hideBin} from 'yargs/helpers'\nimport yargs from 'yargs/yargs'\n\nimport {startDevServer} from '../../server/devServer'\nimport {gracefulServerDeath} from '../../util/servers'\nimport {\n  getDashboardAppURL,\n  getDevServerConfig,\n  type StartDevServerCommandFlags,\n} from '../dev/devAction'\n\nfunction parseCliFlags(args: {argv?: string[]}) {\n  // Using slice(1) to remove the first argument, which is the command `dev` path to the CLI\n  return yargs(hideBin(args.argv || process.argv).slice(1))\n    .options('host', {type: 'string'})\n    .options('port', {type: 'number'})\n    .options('load-in-dashboard', {type: 'boolean', default: true}).argv\n}\n\nexport default async function startAppDevServer(\n  args: CliCommandArguments<StartDevServerCommandFlags>,\n  context: CliCommandContext,\n): Promise<void> {\n  const flags = await parseCliFlags(args)\n  const {output, workDir, cliConfig} = context\n\n  if (!flags.loadInDashboard) {\n    output.warn(`Apps cannot run without the Sanity dashboard`)\n    output.warn(`Starting dev server with the --load-in-dashboard flag set to true`)\n  }\n\n  let organizationId: string | undefined\n  if (cliConfig && 'app' in cliConfig && cliConfig.app?.organizationId) {\n    organizationId = cliConfig.app.organizationId\n  }\n\n  if (!organizationId) {\n    output.error(`Apps require an organization ID (orgId) specified in your sanity.cli.ts file`)\n    process.exit(1)\n  }\n\n  // Try to load CLI configuration from sanity.cli.(js|ts)\n  const config = getDevServerConfig({\n    flags,\n    workDir,\n    cliConfig,\n    output,\n  })\n\n  try {\n    output.print('Starting dev server')\n\n    const {server} = await startDevServer({...config, isApp: true})\n\n    const {port} = server.config.server\n    const httpHost = config.httpHost || 'localhost'\n\n    const dashboardAppUrl = await getDashboardAppURL({\n      organizationId,\n      httpHost,\n      httpPort: port,\n    })\n\n    output.print(`Dev server started on port ${port}`)\n    output.print(`View your app in the Sanity dashboard here:`)\n    output.print(chalk.blue(chalk.underline(dashboardAppUrl)))\n  } catch (err) {\n    gracefulServerDeath('dev', config.httpHost, config.httpPort, err)\n  }\n}\n"],"names":["parseCliFlags","args","yargs","hideBin","argv","process","slice","options","type","default","startAppDevServer","context","flags","output","workDir","cliConfig","loadInDashboard","warn","organizationId","app","error","exit","config","getDevServerConfig","print","server","startDevServer","isApp","port","httpHost","dashboardAppUrl","getDashboardAppURL","httpPort","chalk","blue","underline","err","gracefulServerDeath"],"mappings":";;;;;AAaA,SAASA,cAAcC,MAAyB;AAE9C,SAAOC,MAAMC,QAAQF,KAAKG,QAAQC,QAAQD,IAAI,EAAEE,MAAM,CAAC,CAAC,EACrDC,QAAQ,QAAQ;AAAA,IAACC,MAAM;AAAA,EAAA,CAAS,EAChCD,QAAQ,QAAQ;AAAA,IAACC,MAAM;AAAA,EAAA,CAAS,EAChCD,QAAQ,qBAAqB;AAAA,IAACC,MAAM;AAAA,IAAWC,SAAS;AAAA,EAAA,CAAK,EAAEL;AACpE;AAEA,eAA8BM,kBAC5BT,MACAU,SACe;AACf,QAAMC,QAAQ,MAAMZ,cAAcC,IAAI,GAChC;AAAA,IAACY;AAAAA,IAAQC;AAAAA,IAASC;AAAAA,EAAAA,IAAaJ;AAEhCC,QAAMI,oBACTH,OAAOI,KAAK,8CAA8C,GAC1DJ,OAAOI,KAAK,mEAAmE;AAGjF,MAAIC;AACAH,eAAa,SAASA,aAAaA,UAAUI,KAAKD,mBACpDA,iBAAiBH,UAAUI,IAAID,iBAG5BA,mBACHL,OAAOO,MAAM,8EAA8E,GAC3Ff,QAAQgB,KAAK,CAAC;AAIhB,QAAMC,SAASC,mBAAmB;AAAA,IAChCX;AAAAA,IACAE;AAAAA,IACAC;AAAAA,IACAF;AAAAA,EAAAA,CACD;AAED,MAAI;AACFA,WAAOW,MAAM,qBAAqB;AAElC,UAAM;AAAA,MAACC;AAAAA,IAAAA,IAAU,MAAMC,eAAe;AAAA,MAAC,GAAGJ;AAAAA,MAAQK,OAAO;AAAA,IAAA,CAAK,GAExD;AAAA,MAACC;AAAAA,IAAAA,IAAQH,OAAOH,OAAOG,QACvBI,WAAWP,OAAOO,YAAY,aAE9BC,kBAAkB,MAAMC,mBAAmB;AAAA,MAC/Cb;AAAAA,MACAW;AAAAA,MACAG,UAAUJ;AAAAA,IAAAA,CACX;AAEDf,WAAOW,MAAM,8BAA8BI,IAAI,EAAE,GACjDf,OAAOW,MAAM,6CAA6C,GAC1DX,OAAOW,MAAMS,MAAMC,KAAKD,MAAME,UAAUL,eAAe,CAAC,CAAC;AAAA,EAC3D,SAASM,KAAK;AACZC,wBAAoB,OAAOf,OAAOO,UAAUP,OAAOU,UAAUI,GAAG;AAAA,EAClE;AACF;"}