import {ApiBaseElement} from './api-base.js'

class FiltersComponent extends ApiBaseElement {
  renderFilters = () => {
    const docFunction = this.api.store.selectedFunctionType === 'sanity.function.document'
    const mediaFunction = this.api.store.selectedFunctionType?.startsWith(
      'sanity.function.media-library',
    )

    this.innerHTML = `
        <form class="gap-2 pad-l-3 pad-b-3 border-bottom">
          <fieldset class="flex gap-2">
            <legend class="config-label">Client Options</legend>
            ${
              docFunction
                ? `<select-dropdown
              label="Project"
              store-key="projects"
              selected-key="selectedProject"
              value-prop="id"
              label-prop="displayName"
              trigger-fetch
            ></select-dropdown>
            <select-dropdown
              label="Dataset"
              store-key="datasets"
              selected-key="selectedDataset"
              value-prop="name"
              label-prop="name"
              subscribe-to="selectedProject"
            ></select-dropdown>`
                : ''
            }
            ${
              mediaFunction
                ? `<select-dropdown
              label="Organization"
              store-key="organizations"
              selected-key="selectedOrganization"
              value-prop="id"
              label-prop="name"
              trigger-fetch
            ></select-dropdown>
            <select-dropdown
              label="Media Library"
              store-key="mediaLibraries"
              selected-key="selectedMediaLibrary"
              value-prop="id"
              label-prop="id"
              subscribe-to="selectedOrganization"
            ></select-dropdown>`
                : ''
            }

            <select-dropdown
              label="Event"
              store-key="events"
              selected-key="selectedEvent"
              value-prop="name"
              label-prop="name"
            ></select-dropdown>

            <api-version></api-version>
            <with-token></with-token>
            <document-id></document-id>
          </form>
        `
  }

  connectedCallback() {
    this.innerHTML = this.renderFilters()
    this.api.subscribe(this.renderFilters, ['selectedFunctionType'])
  }

  disconnectedCallback() {
    this.api.unsubscribe(this.renderFilters)
  }
}

customElements.define('filters-component', FiltersComponent)
