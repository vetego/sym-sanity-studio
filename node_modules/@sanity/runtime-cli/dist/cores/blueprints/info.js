import { getStack } from '../../actions/blueprints/stacks.js';
import { formatDeployedResourceTree, formatStackInfo, } from '../../utils/display/blueprints-formatting.js';
import { niceId } from '../../utils/display/presenters.js';
export async function blueprintInfoCore(options) {
    const { log, auth, stackId, flags, deployedStack } = options;
    const { id: flagStackId, verbose: _verbose = false } = flags;
    try {
        const targetStackId = flagStackId || stackId;
        let stack = deployedStack;
        if (flagStackId) {
            const existingStackResponse = await getStack({ stackId: targetStackId, auth });
            if (!existingStackResponse.ok) {
                log(`Could not retrieve Stack deployment info for ${niceId(targetStackId)}`);
                return {
                    success: false,
                    error: existingStackResponse.error || 'Failed to retrieve Stack deployment',
                };
            }
            stack = existingStackResponse.stack;
        }
        log(formatStackInfo(stack, true));
        if (stack.resources)
            log(formatDeployedResourceTree(stack.resources));
        return { success: true };
    }
    catch (error) {
        const errorMessage = error instanceof Error ? error.message : String(error);
        log(`Error: ${errorMessage}`);
        return {
            success: false,
            error: errorMessage,
        };
    }
}
