{"version":3,"sources":["../src/SanityCommand.ts"],"sourcesContent":["import {Command, Interfaces} from '@oclif/core'\n\nimport {getCliConfig} from './config/cli/getCliConfig.js'\nimport {type CliConfig} from './config/cli/types.js'\nimport {findProjectRoot} from './config/findProjectRoot.js'\nimport {type ProjectRootResult} from './config/util/recursivelyResolveProjectRoot.js'\nimport {\n  getGlobalCliClient,\n  getProjectCliClient,\n  type GlobalCliClientOptions,\n  type ProjectCliClientOptions,\n} from './services/apiClient.js'\nimport {type Output} from './types.js'\n\ntype Flags<T extends typeof Command> = Interfaces.InferredFlags<\n  (typeof SanityCommand)['baseFlags'] & T['flags']\n>\n\ntype Args<T extends typeof Command> = Interfaces.InferredArgs<T['args']>\n\nexport abstract class SanityCommand<T extends typeof Command> extends Command {\n  protected args!: Args<T>\n  protected flags!: Flags<T>\n\n  /**\n   * Get the global API client.\n   *\n   * @param args - The global API client options.\n   * @returns The global API client.\n   */\n  protected getGlobalApiClient = (args: GlobalCliClientOptions) => getGlobalCliClient(args)\n\n  /**\n   * Get the project API client.\n   *\n   * @param args - The project API client options.\n   * @returns The project API client.\n   */\n  protected getProjectApiClient = (args: ProjectCliClientOptions) => getProjectCliClient(args)\n\n  /**\n   * Helper for outputting to the console.\n   *\n   * @example\n   * ```ts\n   * this.output.log('Hello')\n   * this.output.warn('Warning')\n   * this.output.error('Error')\n   * ```\n   */\n  protected output: Output = {\n    error: this.error.bind(this),\n    log: this.log.bind(this),\n    warn: this.warn.bind(this),\n  }\n\n  /**\n   * Get the CLI config.\n   *\n   * @returns The CLI config.\n   */\n  protected async getCliConfig(): Promise<CliConfig> {\n    const root = await this.getProjectRoot()\n    const config = await getCliConfig(root.directory)\n\n    return config\n  }\n\n  /**\n   * Get the project ID from the CLI config.\n   *\n   * @returns The project ID or `undefined` if it's not set.\n   */\n  protected async getProjectId(): Promise<string | undefined> {\n    const config = await this.getCliConfig()\n\n    return config.api?.projectId\n  }\n\n  /**\n   * Get the project's root directory by resolving the config\n   *\n   * @returns The root project root.\n   */\n  protected getProjectRoot(): Promise<ProjectRootResult> {\n    return findProjectRoot(process.cwd())\n  }\n\n  public async init(): Promise<void> {\n    const {args, flags} = await this.parse({\n      args: this.ctor.args,\n      baseFlags: (super.ctor as typeof SanityCommand).baseFlags,\n      enableJsonFlag: this.ctor.enableJsonFlag,\n      flags: this.ctor.flags,\n      strict: this.ctor.strict,\n    })\n\n    this.args = args as Args<T>\n    this.flags = flags as Flags<T>\n\n    await super.init()\n  }\n}\n"],"names":["Command","getCliConfig","findProjectRoot","getGlobalCliClient","getProjectCliClient","SanityCommand","args","flags","getGlobalApiClient","getProjectApiClient","output","error","bind","log","warn","root","getProjectRoot","config","directory","getProjectId","api","projectId","process","cwd","init","parse","ctor","baseFlags","enableJsonFlag","strict"],"mappings":"AAAA,SAAQA,OAAO,QAAmB,cAAa;AAE/C,SAAQC,YAAY,QAAO,+BAA8B;AAEzD,SAAQC,eAAe,QAAO,8BAA6B;AAE3D,SACEC,kBAAkB,EAClBC,mBAAmB,QAGd,0BAAyB;AAShC,OAAO,MAAeC,sBAAgDL;IAC1DM,KAAc;IACdC,MAAgB;IAE1B;;;;;GAKC,GACD,AAAUC,qBAAqB,CAACF,OAAiCH,mBAAmBG,MAAK;IAEzF;;;;;GAKC,GACD,AAAUG,sBAAsB,CAACH,OAAkCF,oBAAoBE,MAAK;IAE5F;;;;;;;;;GASC,GACD,AAAUI,SAAiB;QACzBC,OAAO,IAAI,CAACA,KAAK,CAACC,IAAI,CAAC,IAAI;QAC3BC,KAAK,IAAI,CAACA,GAAG,CAACD,IAAI,CAAC,IAAI;QACvBE,MAAM,IAAI,CAACA,IAAI,CAACF,IAAI,CAAC,IAAI;IAC3B,EAAC;IAED;;;;GAIC,GACD,MAAgBX,eAAmC;QACjD,MAAMc,OAAO,MAAM,IAAI,CAACC,cAAc;QACtC,MAAMC,SAAS,MAAMhB,aAAac,KAAKG,SAAS;QAEhD,OAAOD;IACT;IAEA;;;;GAIC,GACD,MAAgBE,eAA4C;QAC1D,MAAMF,SAAS,MAAM,IAAI,CAAChB,YAAY;QAEtC,OAAOgB,OAAOG,GAAG,EAAEC;IACrB;IAEA;;;;GAIC,GACD,AAAUL,iBAA6C;QACrD,OAAOd,gBAAgBoB,QAAQC,GAAG;IACpC;IAEA,MAAaC,OAAsB;QACjC,MAAM,EAAClB,IAAI,EAAEC,KAAK,EAAC,GAAG,MAAM,IAAI,CAACkB,KAAK,CAAC;YACrCnB,MAAM,IAAI,CAACoB,IAAI,CAACpB,IAAI;YACpBqB,WAAW,AAAC,KAAK,CAACD,KAA8BC,SAAS;YACzDC,gBAAgB,IAAI,CAACF,IAAI,CAACE,cAAc;YACxCrB,OAAO,IAAI,CAACmB,IAAI,CAACnB,KAAK;YACtBsB,QAAQ,IAAI,CAACH,IAAI,CAACG,MAAM;QAC1B;QAEA,IAAI,CAACvB,IAAI,GAAGA;QACZ,IAAI,CAACC,KAAK,GAAGA;QAEb,MAAM,KAAK,CAACiB;IACd;AACF"}