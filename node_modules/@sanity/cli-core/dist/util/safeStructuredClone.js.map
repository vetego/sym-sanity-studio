{"version":3,"sources":["../../src/util/safeStructuredClone.ts"],"sourcesContent":["/**\n * `structuredClone()`, but doesn't throw on non-clonable values - instead it drops them.\n *\n * @param obj - The object to clone.\n * @returns The cloned object.\n * @internal\n */\nexport function safeStructuredClone<T>(obj: T): T {\n  const seen = new WeakMap<object, any>()\n\n  function clone<T>(value: T): T {\n    if (typeof value === 'function' || typeof value === 'symbol') {\n      return undefined as unknown as T // Drop non-clonable values\n    }\n    if (value !== null && typeof value === 'object') {\n      if (seen.has(value)) return seen.get(value)\n\n      if (value instanceof Date) return new Date(value) as T\n      if (value instanceof RegExp) return new RegExp(value) as T\n      if (value instanceof Set) return new Set([...value].map((item) => clone(item))) as T\n      if (value instanceof Map)\n        return new Map([...value.entries()].map(([k, v]) => [clone(k), clone(v)])) as T\n      if (ArrayBuffer.isView(value)) return new (value.constructor as any)(value) as T\n\n      const result: any = Array.isArray(value) ? [] : {}\n      seen.set(value, result)\n\n      for (const key in value) {\n        const clonedValue = clone(value[key])\n        if (clonedValue !== undefined) result[key] = clonedValue\n      }\n      return result as T\n    }\n    return value\n  }\n\n  return clone(obj)\n}\n"],"names":["safeStructuredClone","obj","seen","WeakMap","clone","value","undefined","has","get","Date","RegExp","Set","map","item","Map","entries","k","v","ArrayBuffer","isView","result","Array","isArray","set","key","clonedValue"],"mappings":"AAAA;;;;;;CAMC,GACD,OAAO,SAASA,oBAAuBC,GAAM;IAC3C,MAAMC,OAAO,IAAIC;IAEjB,SAASC,MAASC,KAAQ;QACxB,IAAI,OAAOA,UAAU,cAAc,OAAOA,UAAU,UAAU;YAC5D,OAAOC,WAA0B,2BAA2B;QAC9D;QACA,IAAID,UAAU,QAAQ,OAAOA,UAAU,UAAU;YAC/C,IAAIH,KAAKK,GAAG,CAACF,QAAQ,OAAOH,KAAKM,GAAG,CAACH;YAErC,IAAIA,iBAAiBI,MAAM,OAAO,IAAIA,KAAKJ;YAC3C,IAAIA,iBAAiBK,QAAQ,OAAO,IAAIA,OAAOL;YAC/C,IAAIA,iBAAiBM,KAAK,OAAO,IAAIA,IAAI;mBAAIN;aAAM,CAACO,GAAG,CAAC,CAACC,OAAST,MAAMS;YACxE,IAAIR,iBAAiBS,KACnB,OAAO,IAAIA,IAAI;mBAAIT,MAAMU,OAAO;aAAG,CAACH,GAAG,CAAC,CAAC,CAACI,GAAGC,EAAE,GAAK;oBAACb,MAAMY;oBAAIZ,MAAMa;iBAAG;YAC1E,IAAIC,YAAYC,MAAM,CAACd,QAAQ,OAAO,IAAKA,MAAM,WAAW,CAASA;YAErE,MAAMe,SAAcC,MAAMC,OAAO,CAACjB,SAAS,EAAE,GAAG,CAAC;YACjDH,KAAKqB,GAAG,CAAClB,OAAOe;YAEhB,IAAK,MAAMI,OAAOnB,MAAO;gBACvB,MAAMoB,cAAcrB,MAAMC,KAAK,CAACmB,IAAI;gBACpC,IAAIC,gBAAgBnB,WAAWc,MAAM,CAACI,IAAI,GAAGC;YAC/C;YACA,OAAOL;QACT;QACA,OAAOf;IACT;IAEA,OAAOD,MAAMH;AACf"}