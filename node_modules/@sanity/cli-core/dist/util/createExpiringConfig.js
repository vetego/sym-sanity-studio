/**
 * Create a config in the provided config store that expires after the provided TTL.
 */ export function createExpiringConfig({ fetchValue, key, onCacheHit = ()=>null, onFetch = ()=>null, onRevalidate = ()=>null, store, ttl }) {
    let currentFetch = null;
    return {
        delete () {
            store.delete(key);
        },
        async get () {
            const { updatedAt, value } = store.get(key) ?? {};
            if (value && updatedAt) {
                const hasExpired = Date.now() - updatedAt > ttl;
                if (!hasExpired) {
                    onCacheHit();
                    return value;
                }
                onRevalidate();
            }
            if (currentFetch) {
                return currentFetch;
            }
            onFetch();
            currentFetch = Promise.resolve(fetchValue());
            const nextValue = await currentFetch;
            currentFetch = null;
            store.set(key, {
                updatedAt: Date.now(),
                value: nextValue
            });
            return nextValue;
        }
    };
}

//# sourceMappingURL=createExpiringConfig.js.map