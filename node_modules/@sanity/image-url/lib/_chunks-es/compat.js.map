{"version":3,"file":"compat.js","sources":["../../src/parseAssetId.ts","../../src/parseSource.ts","../../src/urlForImage.ts","../../src/builder.ts","../../src/compat.ts"],"sourcesContent":["const example = 'image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg'\n\n/**\n * @internal\n */\nexport function parseAssetId(ref: string) {\n  const [, id, dimensionString, format] = ref.split('-')\n\n  if (!id || !dimensionString || !format) {\n    throw new Error(`Malformed asset _ref '${ref}'. Expected an id like \"${example}\".`)\n  }\n\n  const [imgWidthStr, imgHeightStr] = dimensionString.split('x')\n\n  const width = +imgWidthStr\n  const height = +imgHeightStr\n\n  const isValidAssetId = isFinite(width) && isFinite(height)\n  if (!isValidAssetId) {\n    throw new Error(`Malformed asset _ref '${ref}'. Expected an id like \"${example}\".`)\n  }\n\n  return {id, width, height, format}\n}\n","import type {\n  SanityAsset,\n  SanityImageObject,\n  SanityImageSource,\n  SanityImageWithAssetStub,\n  SanityReference,\n} from './types'\n\nconst isRef = (src: SanityImageSource): src is SanityReference => {\n  const source = src as SanityReference\n  return source ? typeof source._ref === 'string' : false\n}\n\nconst isAsset = (src: SanityImageSource): src is SanityAsset => {\n  const source = src as SanityAsset\n  return source ? typeof source._id === 'string' : false\n}\n\nconst isAssetStub = (src: SanityImageSource): src is SanityImageWithAssetStub => {\n  const source = src as SanityImageWithAssetStub\n  return source && source.asset ? typeof source.asset.url === 'string' : false\n}\n\n// Detect in-progress uploads (has upload key but no complete asset reference)\nexport const isInProgressUpload = (src: SanityImageSource): boolean => {\n  if (typeof src === 'object' && src !== null) {\n    const obj = src as any\n    // Check if it has an upload key (indicating in-progress upload)\n    return obj._upload && (!obj.asset || !obj.asset._ref)\n  }\n  return false\n}\n\n/**\n * @internal\n * Convert an asset-id, asset or image to an image record suitable for processing\n */\nexport function parseSource(source?: SanityImageSource) {\n  if (!source) {\n    return null\n  }\n\n  let image: SanityImageObject\n\n  if (typeof source === 'string' && isUrl(source)) {\n    // Someone passed an existing image url?\n    image = {\n      asset: {_ref: urlToId(source)},\n    }\n  } else if (typeof source === 'string') {\n    // Just an asset id\n    image = {\n      asset: {_ref: source},\n    }\n  } else if (isRef(source)) {\n    // We just got passed an asset directly\n    image = {\n      asset: source,\n    }\n  } else if (isAsset(source)) {\n    // If we were passed an image asset document\n    image = {\n      asset: {\n        _ref: source._id || '',\n      },\n    }\n  } else if (isAssetStub(source)) {\n    // If we were passed a partial asset (`url`, but no `_id`)\n    image = {\n      asset: {\n        _ref: urlToId(source.asset.url),\n      },\n    }\n  } else if (typeof source.asset === 'object') {\n    // Probably an actual image with materialized asset\n    image = {...source}\n  } else {\n    // We got something that does not look like an image, or it is an image\n    // that currently isn't sporting an asset.\n    return null\n  }\n\n  const img = source as SanityImageObject\n  if (img.crop) {\n    image.crop = img.crop\n  }\n\n  if (img.hotspot) {\n    image.hotspot = img.hotspot\n  }\n\n  return applyDefaults(image)\n}\n\nfunction isUrl(url: string) {\n  return /^https?:\\/\\//.test(`${url}`)\n}\n\nfunction urlToId(url: string) {\n  const parts = url.split('/').slice(-1)\n  return `image-${parts[0]}`.replace(/\\.([a-z]+)$/, '-$1')\n}\n\n// Mock crop and hotspot if image lacks it\nfunction applyDefaults(image: SanityImageObject) {\n  if (image.crop && image.hotspot) {\n    return image as Required<SanityImageObject>\n  }\n\n  // We need to pad in default values for crop or hotspot\n  const result = {...image}\n\n  if (!result.crop) {\n    result.crop = {\n      left: 0,\n      top: 0,\n      bottom: 0,\n      right: 0,\n    }\n  }\n\n  if (!result.hotspot) {\n    result.hotspot = {\n      x: 0.5,\n      y: 0.5,\n      height: 1.0,\n      width: 1.0,\n    }\n  }\n\n  return result as Required<SanityImageObject>\n}\n","import {parseAssetId} from './parseAssetId'\nimport {parseSource, isInProgressUpload} from './parseSource'\nimport type {\n  CropSpec,\n  HotspotSpec,\n  ImageUrlBuilderOptions,\n  ImageUrlBuilderOptionsWithAsset,\n  SanityAsset,\n  SanityImageFitResult,\n  SanityImageRect,\n  SanityReference,\n} from './types'\n\nexport const SPEC_NAME_TO_URL_NAME_MAPPINGS = [\n  ['width', 'w'],\n  ['height', 'h'],\n  ['format', 'fm'],\n  ['download', 'dl'],\n  ['blur', 'blur'],\n  ['sharpen', 'sharp'],\n  ['invert', 'invert'],\n  ['orientation', 'or'],\n  ['minHeight', 'min-h'],\n  ['maxHeight', 'max-h'],\n  ['minWidth', 'min-w'],\n  ['maxWidth', 'max-w'],\n  ['quality', 'q'],\n  ['fit', 'fit'],\n  ['crop', 'crop'],\n  ['saturation', 'sat'],\n  ['auto', 'auto'],\n  ['dpr', 'dpr'],\n  ['pad', 'pad'],\n  ['frame', 'frame'],\n]\n\n/**\n * @internal\n */\nexport function urlForImage(options: ImageUrlBuilderOptions): string {\n  let spec = {...(options || {})}\n  const source = spec.source\n  delete spec.source\n\n  const image = parseSource(source)\n  if (!image) {\n    if (source && isInProgressUpload(source)) {\n      // This is a placeholder image that will be replaced with the actual image when the upload is complete\n      // This is a 0x0 transparent PNG image\n      return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8HwQACfsD/QNViZkAAAAASUVORK5CYII='\n    }\n    throw new Error(`Unable to resolve image URL from source (${JSON.stringify(source)})`)\n  }\n\n  const id = (image.asset as SanityReference)._ref || (image.asset as SanityAsset)._id || ''\n  const asset = parseAssetId(id)\n\n  // Compute crop rect in terms of pixel coordinates in the raw source image\n  const cropLeft = Math.round(image.crop.left * asset.width)\n  const cropTop = Math.round(image.crop.top * asset.height)\n  const crop = {\n    left: cropLeft,\n    top: cropTop,\n    width: Math.round(asset.width - image.crop.right * asset.width - cropLeft),\n    height: Math.round(asset.height - image.crop.bottom * asset.height - cropTop),\n  }\n\n  // Compute hot spot rect in terms of pixel coordinates\n  const hotSpotVerticalRadius = (image.hotspot.height * asset.height) / 2\n  const hotSpotHorizontalRadius = (image.hotspot.width * asset.width) / 2\n  const hotSpotCenterX = image.hotspot.x * asset.width\n  const hotSpotCenterY = image.hotspot.y * asset.height\n  const hotspot = {\n    left: hotSpotCenterX - hotSpotHorizontalRadius,\n    top: hotSpotCenterY - hotSpotVerticalRadius,\n    right: hotSpotCenterX + hotSpotHorizontalRadius,\n    bottom: hotSpotCenterY + hotSpotVerticalRadius,\n  }\n\n  // If irrelevant, or if we are requested to: don't perform crop/fit based on\n  // the crop/hotspot.\n  if (!(spec.rect || spec.focalPoint || spec.ignoreImageParams || spec.crop)) {\n    spec = {...spec, ...fit({crop, hotspot}, spec)}\n  }\n\n  return specToImageUrl({...spec, asset})\n}\n\n// eslint-disable-next-line complexity\nfunction specToImageUrl(spec: ImageUrlBuilderOptionsWithAsset) {\n  const cdnUrl = (spec.baseUrl || 'https://cdn.sanity.io').replace(/\\/+$/, '')\n  const vanityStub = spec.vanityName ? `/${spec.vanityName}` : ''\n  const filename = `${spec.asset.id}-${spec.asset.width}x${spec.asset.height}.${spec.asset.format}${vanityStub}`\n  const baseUrl = spec.mediaLibraryId\n    ? `${cdnUrl}/media-libraries/${spec.mediaLibraryId}/images/${filename}`\n    : `${cdnUrl}/images/${spec.projectId}/${spec.dataset}/${filename}`\n\n  const params: string[] = []\n\n  if (spec.rect) {\n    // Only bother url with a crop if it actually crops anything\n    const {left, top, width, height} = spec.rect\n    const isEffectiveCrop =\n      left !== 0 || top !== 0 || height !== spec.asset.height || width !== spec.asset.width\n\n    if (isEffectiveCrop) {\n      params.push(`rect=${left},${top},${width},${height}`)\n    }\n  }\n\n  if (spec.bg) {\n    params.push(`bg=${spec.bg}`)\n  }\n\n  if (spec.focalPoint) {\n    params.push(`fp-x=${spec.focalPoint.x}`)\n    params.push(`fp-y=${spec.focalPoint.y}`)\n  }\n\n  const flip = [spec.flipHorizontal && 'h', spec.flipVertical && 'v'].filter(Boolean).join('')\n  if (flip) {\n    params.push(`flip=${flip}`)\n  }\n\n  // Map from spec name to url param name, and allow using the actual param name as an alternative\n  SPEC_NAME_TO_URL_NAME_MAPPINGS.forEach((mapping) => {\n    const [specName, param] = mapping\n    if (typeof spec[specName] !== 'undefined') {\n      params.push(`${param}=${encodeURIComponent(spec[specName])}`)\n    } else if (typeof spec[param] !== 'undefined') {\n      params.push(`${param}=${encodeURIComponent(spec[param])}`)\n    }\n  })\n\n  if (params.length === 0) {\n    return baseUrl\n  }\n\n  return `${baseUrl}?${params.join('&')}`\n}\n\nfunction fit(\n  source: {crop: CropSpec; hotspot: HotspotSpec},\n  spec: ImageUrlBuilderOptions\n): SanityImageFitResult {\n  let cropRect: SanityImageRect\n\n  const imgWidth = spec.width\n  const imgHeight = spec.height\n\n  // If we are not constraining the aspect ratio, we'll just use the whole crop\n  if (!(imgWidth && imgHeight)) {\n    return {width: imgWidth, height: imgHeight, rect: source.crop}\n  }\n\n  const crop = source.crop\n  const hotspot = source.hotspot\n\n  // If we are here, that means aspect ratio is locked and fitting will be a bit harder\n  const desiredAspectRatio = imgWidth / imgHeight\n  const cropAspectRatio = crop.width / crop.height\n\n  if (cropAspectRatio > desiredAspectRatio) {\n    // The crop is wider than the desired aspect ratio. That means we are cutting from the sides\n    const height = Math.round(crop.height)\n    const width = Math.round(height * desiredAspectRatio)\n    const top = Math.max(0, Math.round(crop.top))\n\n    // Center output horizontally over hotspot\n    const hotspotXCenter = Math.round((hotspot.right - hotspot.left) / 2 + hotspot.left)\n    let left = Math.max(0, Math.round(hotspotXCenter - width / 2))\n\n    // Keep output within crop\n    if (left < crop.left) {\n      left = crop.left\n    } else if (left + width > crop.left + crop.width) {\n      left = crop.left + crop.width - width\n    }\n\n    cropRect = {left, top, width, height}\n  } else {\n    // The crop is taller than the desired ratio, we are cutting from top and bottom\n    const width = crop.width\n    const height = Math.round(width / desiredAspectRatio)\n    const left = Math.max(0, Math.round(crop.left))\n\n    // Center output vertically over hotspot\n    const hotspotYCenter = Math.round((hotspot.bottom - hotspot.top) / 2 + hotspot.top)\n    let top = Math.max(0, Math.round(hotspotYCenter - height / 2))\n\n    // Keep output rect within crop\n    if (top < crop.top) {\n      top = crop.top\n    } else if (top + height > crop.top + crop.height) {\n      top = crop.top + crop.height - height\n    }\n\n    cropRect = {left, top, width, height}\n  }\n\n  return {\n    width: imgWidth,\n    height: imgHeight,\n    rect: cropRect,\n  }\n}\n","import type {\n  AutoMode,\n  CropMode,\n  FitMode,\n  ImageFormat,\n  ImageUrlBuilder,\n  ImageUrlBuilderOptions,\n  ImageUrlBuilderOptionsWithAliases,\n  SanityClientConfig,\n  SanityModernClientLike,\n  Orientation,\n  SanityClientLike,\n  SanityImageSource,\n  SanityProjectDetails,\n} from './types'\nimport {urlForImage, SPEC_NAME_TO_URL_NAME_MAPPINGS} from './urlForImage'\n\nconst validFits = ['clip', 'crop', 'fill', 'fillmax', 'max', 'scale', 'min']\nconst validCrops = ['top', 'bottom', 'left', 'right', 'center', 'focalpoint', 'entropy']\nconst validAutoModes = ['format']\n\nfunction isSanityModernClientLike(\n  client?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): client is SanityModernClientLike {\n  return client && 'config' in client ? typeof client.config === 'function' : false\n}\n\nfunction isSanityClientLike(\n  client?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): client is SanityClientLike {\n  return client && 'clientConfig' in client ? typeof client.clientConfig === 'object' : false\n}\n\nfunction clientConfigToOptions(config: SanityClientConfig): ImageUrlBuilderOptions {\n  const {apiHost: apiUrl, projectId, dataset} = config\n  const apiHost = apiUrl || 'https://api.sanity.io'\n  const baseOptions: ImageUrlBuilderOptions = {\n    baseUrl: apiHost.replace(/^https:\\/\\/api\\./, 'https://cdn.'),\n  }\n\n  const resource = config['~experimental_resource']\n  if (resource?.type === 'media-library') {\n    if (typeof resource.id !== 'string' || resource.id.length === 0) {\n      throw new Error('Media library clients must include an id in \"~experimental_resource\"')\n    }\n\n    return {...baseOptions, mediaLibraryId: resource.id}\n  }\n\n  return {...baseOptions, projectId, dataset}\n}\n\n/**\n * @internal\n */\nexport function rewriteSpecName(key: string) {\n  const specs = SPEC_NAME_TO_URL_NAME_MAPPINGS\n  for (const entry of specs) {\n    const [specName, param] = entry\n    if (key === specName || key === param) {\n      return specName\n    }\n  }\n\n  return key\n}\n\nfunction getOptions(_options?: SanityClientLike | SanityProjectDetails | SanityModernClientLike) {\n  let options: ImageUrlBuilderOptions = {}\n\n  if (isSanityModernClientLike(_options)) {\n    // Inherit config from client\n    options = clientConfigToOptions(_options.config())\n  }\n\n  // Did we get a SanityClient?\n  else if (isSanityClientLike(_options)) {\n    // Inherit config from client\n    options = clientConfigToOptions(_options.clientConfig)\n  }\n\n  // Or just accept the options as given\n  else {\n    options = _options || {}\n  }\n\n  return options\n}\n\n/**\n * @internal\n */\nexport function createBuilder<Impl extends typeof ImageUrlBuilderImpl, T extends ImageUrlBuilder>(\n  Builder: Impl,\n  _options?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): T {\n  const options = getOptions(_options)\n  return new Builder(null, options) as T\n}\n\n/**\n * @public\n */\nexport function createImageUrlBuilder(\n  options?: SanityClientLike | SanityProjectDetails | SanityModernClientLike\n): ImageUrlBuilder {\n  return createBuilder(ImageUrlBuilderImpl, options)\n}\n\n/**\n * @internal\n */\n\nexport function constructNewOptions(\n  currentOptions: ImageUrlBuilderOptions,\n  options: Partial<ImageUrlBuilderOptionsWithAliases>\n) {\n  const baseUrl = options.baseUrl || currentOptions.baseUrl\n\n  const newOptions: {[key: string]: any} = {baseUrl}\n  for (const key in options) {\n    if (options.hasOwnProperty(key)) {\n      const specKey = rewriteSpecName(key)\n      newOptions[specKey] = options[key]\n    }\n  }\n  return {baseUrl, ...newOptions}\n}\n\n/**\n * @internal\n */\nexport class ImageUrlBuilderImpl implements ImageUrlBuilder {\n  public options: ImageUrlBuilderOptions\n\n  constructor(parent: ImageUrlBuilderImpl | null, options: ImageUrlBuilderOptions) {\n    this.options = parent\n      ? {...(parent.options || {}), ...(options || {})} // Merge parent options\n      : {...(options || {})} // Copy options\n  }\n\n  withOptions(options: ImageUrlBuilderOptionsWithAliases): this {\n    const newOptions = constructNewOptions(this.options, options)\n    return new ImageUrlBuilderImpl(this, newOptions) as this\n  }\n\n  // The image to be represented. Accepts a Sanity 'image'-document, 'asset'-document or\n  // _id of asset. To get the benefit of automatic hot-spot/crop integration with the content\n  // studio, the 'image'-document must be provided.\n  image(source: SanityImageSource) {\n    return this.withOptions({source})\n  }\n\n  // Specify the dataset\n  dataset(dataset: string) {\n    return this.withOptions({dataset})\n  }\n\n  // Specify the projectId\n  projectId(projectId: string) {\n    return this.withOptions({projectId})\n  }\n\n  withClient(client: SanityClientLike | SanityProjectDetails | SanityModernClientLike) {\n    const newOptions = getOptions(client)\n\n    const preservedOptions = {...this.options}\n    delete preservedOptions.baseUrl\n    delete preservedOptions.projectId\n    delete preservedOptions.dataset\n    delete preservedOptions.mediaLibraryId\n\n    return new ImageUrlBuilderImpl(null, {...newOptions, ...preservedOptions}) as this\n  }\n\n  // Specify background color\n  bg(bg: string) {\n    return this.withOptions({bg})\n  }\n\n  // Set DPR scaling factor\n  dpr(dpr: number) {\n    // A DPR of 1 is the default - so only include it if we have a different value\n    return this.withOptions(dpr && dpr !== 1 ? {dpr} : {})\n  }\n\n  // Specify the width of the image in pixels\n  width(width: number) {\n    return this.withOptions({width})\n  }\n\n  // Specify the height of the image in pixels\n  height(height: number) {\n    return this.withOptions({height})\n  }\n\n  // Specify focal point in fraction of image dimensions. Each component 0.0-1.0\n  focalPoint(x: number, y: number) {\n    return this.withOptions({focalPoint: {x, y}})\n  }\n\n  maxWidth(maxWidth: number) {\n    return this.withOptions({maxWidth})\n  }\n\n  minWidth(minWidth: number) {\n    return this.withOptions({minWidth})\n  }\n\n  maxHeight(maxHeight: number) {\n    return this.withOptions({maxHeight})\n  }\n\n  minHeight(minHeight: number) {\n    return this.withOptions({minHeight})\n  }\n\n  // Specify width and height in pixels\n  size(width: number, height: number) {\n    return this.withOptions({width, height})\n  }\n\n  // Specify blur between 0 and 100\n  blur(blur: number) {\n    return this.withOptions({blur})\n  }\n\n  sharpen(sharpen: number) {\n    return this.withOptions({sharpen})\n  }\n\n  // Specify the desired rectangle of the image\n  rect(left: number, top: number, width: number, height: number) {\n    return this.withOptions({rect: {left, top, width, height}})\n  }\n\n  // Specify the image format of the image. 'jpg', 'pjpg', 'png', 'webp'\n  format(format?: ImageFormat | undefined) {\n    return this.withOptions({format})\n  }\n\n  invert(invert: boolean) {\n    return this.withOptions({invert})\n  }\n\n  // Rotation in degrees 0, 90, 180, 270\n  orientation(orientation: Orientation) {\n    return this.withOptions({orientation})\n  }\n\n  // Compression quality 0-100\n  quality(quality: number) {\n    return this.withOptions({quality})\n  }\n\n  // Make it a download link. Parameter is default filename.\n  forceDownload(download: boolean | string) {\n    return this.withOptions({download})\n  }\n\n  // Flip image horizontally\n  flipHorizontal() {\n    return this.withOptions({flipHorizontal: true})\n  }\n\n  // Flip image vertically\n  flipVertical() {\n    return this.withOptions({flipVertical: true})\n  }\n\n  // Ignore crop/hotspot from image record, even when present\n  ignoreImageParams() {\n    return this.withOptions({ignoreImageParams: true})\n  }\n\n  fit(value: FitMode) {\n    if (validFits.indexOf(value) === -1) {\n      throw new Error(`Invalid fit mode \"${value}\"`)\n    }\n\n    return this.withOptions({fit: value})\n  }\n\n  crop(value: CropMode) {\n    if (validCrops.indexOf(value) === -1) {\n      throw new Error(`Invalid crop mode \"${value}\"`)\n    }\n\n    return this.withOptions({crop: value})\n  }\n\n  // Saturation\n  saturation(saturation: number) {\n    return this.withOptions({saturation})\n  }\n\n  auto(value: AutoMode) {\n    if (validAutoModes.indexOf(value) === -1) {\n      throw new Error(`Invalid auto mode \"${value}\"`)\n    }\n\n    return this.withOptions({auto: value})\n  }\n\n  // Specify the number of pixels to pad the image\n  pad(pad: number) {\n    return this.withOptions({pad})\n  }\n\n  // Vanity URL for more SEO friendly URLs\n  vanityName(value: string) {\n    return this.withOptions({vanityName: value})\n  }\n\n  frame(frame: number) {\n    if (frame !== 1) {\n      throw new Error(`Invalid frame value \"${frame}\"`)\n    }\n\n    return this.withOptions({frame})\n  }\n\n  // Gets the url based on the submitted parameters\n  url() {\n    return urlForImage(this.options)\n  }\n\n  // Alias for url()\n  toString() {\n    return this.url()\n  }\n}\n","function once<TFn extends (...args: never[]) => unknown>(fn: TFn) {\n  let didCall = false\n  let returnValue: ReturnType<TFn> | undefined\n  return (...args: Parameters<TFn>): ReturnType<TFn> => {\n    if (didCall) {\n      return returnValue as ReturnType<TFn>\n    }\n    returnValue = fn(...args) as ReturnType<TFn>\n    didCall = true\n    return returnValue\n  }\n}\n\nconst createWarningPrinter = (message: readonly string[]) =>\n  once((...args: unknown[]) => {\n    // tslint:disable-next-line:no-console -- warn once while keeping old default import usable\n    console.warn(message.join(' '), ...args)\n  })\n\nconst printNoDefaultExport = createWarningPrinter([\n  'The default export of @sanity/image-url has been deprecated. Use the named export `createImageUrlBuilder` instead.',\n])\n\n/* @internal */\nexport function defineDeprecated<ImageUrlBuilder, OptionsType>(\n  createImageUrlBuilder: (options?: OptionsType) => ImageUrlBuilder\n) {\n  return function deprecatedCreateImageUrlBuilder(options?: OptionsType) {\n    printNoDefaultExport()\n    return createImageUrlBuilder(options)\n  }\n}\n"],"names":["createImageUrlBuilder"],"mappings":"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"}