{"version":3,"file":"index.js","sources":["../src/plugin.one-line.tsx"],"sourcesContent":["import {useEditor} from '@portabletext/editor'\nimport {defineBehavior, raise} from '@portabletext/editor/behaviors'\nimport * as selectors from '@portabletext/editor/selectors'\nimport * as utils from '@portabletext/editor/utils'\nimport {useEffect} from 'react'\n\nconst oneLineBehaviors = [\n  /**\n   * Hitting Enter on an expanded selection should just delete that selection\n   * without causing a line break.\n   */\n  defineBehavior({\n    on: 'insert.break',\n    guard: ({snapshot}) =>\n      snapshot.context.selection && selectors.isSelectionExpanded(snapshot)\n        ? {selection: snapshot.context.selection}\n        : false,\n    actions: [(_, {selection}) => [raise({type: 'delete', at: selection})]],\n  }),\n  /**\n   * All other cases of `insert.break` should be aborted.\n   */\n  defineBehavior({\n    on: 'insert.break',\n    actions: [],\n  }),\n  /**\n   * `insert.block` `before` or `after` is not allowed in a one-line editor.\n   */\n  defineBehavior({\n    on: 'insert.block',\n    guard: ({event}) =>\n      event.placement === 'before' || event.placement === 'after',\n    actions: [],\n  }),\n  /**\n   * An ordinary `insert.block` is acceptable if it's a text block. In that\n   * case it will get merged into the existing text block.\n   */\n  defineBehavior({\n    on: 'insert.block',\n    guard: ({snapshot, event}) => {\n      const focusTextBlock = selectors.getFocusTextBlock(snapshot)\n\n      if (\n        !focusTextBlock ||\n        !utils.isTextBlock(snapshot.context, event.block)\n      ) {\n        return false\n      }\n\n      return event.placement !== 'auto' || event.select !== 'end'\n    },\n    actions: [\n      ({event}) => [\n        raise({\n          type: 'insert.block',\n          block: event.block,\n          placement: 'auto',\n          select: 'end',\n        }),\n      ],\n    ],\n  }),\n  /**\n   * Fallback Behavior to avoid `insert.block` in case the Behaviors above all\n   * end up with a falsy guard.\n   */\n  defineBehavior({\n    on: 'insert.block',\n    guard: ({snapshot, event}) => {\n      const focusTextBlock = selectors.getFocusTextBlock(snapshot)\n\n      if (!focusTextBlock) {\n        return true\n      }\n\n      return !utils.isTextBlock(snapshot.context, event.block)\n    },\n    actions: [],\n  }),\n  /**\n   * If multiple blocks are inserted, then the non-text blocks are filtered out\n   * and the text blocks are merged into one block\n   */\n  defineBehavior({\n    on: 'insert.blocks',\n    guard: ({snapshot, event}) => {\n      const textBlocks = event.blocks.filter((block) =>\n        utils.isTextBlock(snapshot.context, block),\n      )\n\n      if (textBlocks.length === 0) {\n        return false\n      }\n\n      return textBlocks.reduce((targetBlock, incomingBlock) => {\n        return utils.mergeTextBlocks({\n          context: snapshot.context,\n          targetBlock,\n          incomingBlock,\n        })\n      })\n    },\n    actions: [\n      // `insert.block` is raised so the Behavior above can handle the\n      // insertion\n      (_, block) => [raise({type: 'insert.block', block, placement: 'auto'})],\n    ],\n  }),\n  /**\n   * Fallback Behavior to avoid `insert.blocks` in case the Behavior above\n   * ends up with a falsy guard.\n   */\n  defineBehavior({\n    on: 'insert.blocks',\n    actions: [],\n  }),\n]\n\n/**\n * @public\n * Restrict the editor to one line. The plugin takes care of blocking\n * `insert.break` events and smart handling of other `insert.*` events.\n *\n * Place it with as high priority as possible to make sure other plugins don't\n * overwrite `insert.*` events before this plugin gets a chance to do so.\n */\nexport function OneLinePlugin() {\n  const editor = useEditor()\n\n  useEffect(() => {\n    const unregisterBehaviors = oneLineBehaviors.map((behavior) =>\n      editor.registerBehavior({behavior}),\n    )\n\n    return () => {\n      for (const unregisterBehavior of unregisterBehaviors) {\n        unregisterBehavior()\n      }\n    }\n  }, [editor])\n\n  return null\n}\n"],"names":["oneLineBehaviors","defineBehavior","on","guard","snapshot","context","selection","selectors","isSelectionExpanded","actions","_","raise","type","at","event","placement","getFocusTextBlock","utils","isTextBlock","block","select","textBlocks","blocks","filter","length","reduce","targetBlock","incomingBlock","mergeTextBlocks","OneLinePlugin","$","_c","editor","useEditor","t0","t1","unregisterBehaviors","map","behavior","registerBehavior","unregisterBehavior","useEffect"],"mappings":";;;;;;AAMA,MAAMA,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKvBC,eAAe;AAAA,IACbC,IAAI;AAAA,IACJC,OAAOA,CAAC;AAAA,MAACC;AAAAA,IAAAA,MACPA,SAASC,QAAQC,aAAaC,UAAUC,oBAAoBJ,QAAQ,IAChE;AAAA,MAACE,WAAWF,SAASC,QAAQC;AAAAA,IAAAA,IAC7B;AAAA,IACNG,SAAS,CAAC,CAACC,GAAG;AAAA,MAACJ;AAAAA,IAAAA,MAAe,CAACK,MAAM;AAAA,MAACC,MAAM;AAAA,MAAUC,IAAIP;AAAAA,IAAAA,CAAU,CAAC,CAAC;AAAA,EAAA,CACvE;AAAA;AAAA;AAAA;AAAA,EAIDL,eAAe;AAAA,IACbC,IAAI;AAAA,IACJO,SAAS,CAAA;AAAA,EAAA,CACV;AAAA;AAAA;AAAA;AAAA,EAIDR,eAAe;AAAA,IACbC,IAAI;AAAA,IACJC,OAAOA,CAAC;AAAA,MAACW;AAAAA,IAAAA,MACPA,MAAMC,cAAc,YAAYD,MAAMC,cAAc;AAAA,IACtDN,SAAS,CAAA;AAAA,EAAA,CACV;AAAA;AAAA;AAAA;AAAA;AAAA,EAKDR,eAAe;AAAA,IACbC,IAAI;AAAA,IACJC,OAAOA,CAAC;AAAA,MAACC;AAAAA,MAAUU;AAAAA,IAAAA,MAIf,CAHqBP,UAAUS,kBAAkBZ,QAAQ,KAIzD,CAACa,MAAMC,YAAYd,SAASC,SAASS,MAAMK,KAAK,IAEzC,KAGFL,MAAMC,cAAc,UAAUD,MAAMM,WAAW;AAAA,IAExDX,SAAS,CACP,CAAC;AAAA,MAACK;AAAAA,IAAAA,MAAW,CACXH,MAAM;AAAA,MACJC,MAAM;AAAA,MACNO,OAAOL,MAAMK;AAAAA,MACbJ,WAAW;AAAA,MACXK,QAAQ;AAAA,IAAA,CACT,CAAC,CACH;AAAA,EAAA,CAEJ;AAAA;AAAA;AAAA;AAAA;AAAA,EAKDnB,eAAe;AAAA,IACbC,IAAI;AAAA,IACJC,OAAOA,CAAC;AAAA,MAACC;AAAAA,MAAUU;AAAAA,IAAAA,MACMP,UAAUS,kBAAkBZ,QAAQ,IAMpD,CAACa,MAAMC,YAAYd,SAASC,SAASS,MAAMK,KAAK,IAH9C;AAAA,IAKXV,SAAS,CAAA;AAAA,EAAA,CACV;AAAA;AAAA;AAAA;AAAA;AAAA,EAKDR,eAAe;AAAA,IACbC,IAAI;AAAA,IACJC,OAAOA,CAAC;AAAA,MAACC;AAAAA,MAAUU;AAAAA,IAAAA,MAAW;AAC5B,YAAMO,aAAaP,MAAMQ,OAAOC,OAAQJ,CAAAA,UACtCF,MAAMC,YAAYd,SAASC,SAASc,KAAK,CAC3C;AAEA,aAAIE,WAAWG,WAAW,IACjB,KAGFH,WAAWI,OAAO,CAACC,aAAaC,kBAC9BV,MAAMW,gBAAgB;AAAA,QAC3BvB,SAASD,SAASC;AAAAA,QAClBqB;AAAAA,QACAC;AAAAA,MAAAA,CACD,CACF;AAAA,IACH;AAAA,IACAlB,SAAS;AAAA;AAAA;AAAA,MAGP,CAACC,GAAGS,UAAU,CAACR,MAAM;AAAA,QAACC,MAAM;AAAA,QAAgBO;AAAAA,QAAOJ,WAAW;AAAA,MAAA,CAAO,CAAC;AAAA,IAAA;AAAA,EAAC,CAE1E;AAAA;AAAA;AAAA;AAAA;AAAA,EAKDd,eAAe;AAAA,IACbC,IAAI;AAAA,IACJO,SAAS,CAAA;AAAA,EAAA,CACV;AAAC;AAWG,SAAAoB,gBAAA;AAAA,QAAAC,IAAAC,EAAA,CAAA,GACLC,SAAeC,UAAAA;AAAW,MAAAC,IAAAC;AAAA,SAAAL,SAAAE,UAEhBE,KAAAA,MAAA;AACR,UAAAE,sBAA4BpC,iBAAgBqC,IAAKC,CAAAA,aAC/CN,OAAMO,iBAAkB;AAAA,MAAAD;AAAAA,IAAAA,CAAU,CACpC;AAAC,WAEM,MAAA;AACL,iBAAKE,sBAA4BJ;AAC/BI,2BAAAA;AAAAA,IACD;AAAA,EACF,GACAL,KAAA,CAACH,MAAM,GAACF,OAAAE,QAAAF,OAAAI,IAAAJ,OAAAK,OAAAD,KAAAJ,EAAA,CAAA,GAAAK,KAAAL,EAAA,CAAA,IAVXW,UAAUP,IAUPC,EAAQ,GAEJ;AAAI;"}