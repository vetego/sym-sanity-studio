{"version":3,"file":"index.js","sources":["../src/regex.character-pair.ts","../src/behavior.character-pair-decorator.ts","../src/plugin.character-pair-decorator.ts"],"sourcesContent":["export function createCharacterPairRegex(char: string, amount: number) {\n  // Negative lookbehind: Ensures that the matched sequence is not preceded by the same character\n  const prePrefix = `(?<!\\\\${char})`\n\n  // Repeats the character `amount` times\n  const prefix = `\\\\${char}`.repeat(Math.max(amount, 1))\n\n  // Negative lookahead: Ensures that the opening pair (**, *, etc.) is not followed by a space\n  const postPrefix = `(?!\\\\s)`\n\n  // Captures the content inside the pair\n  const content = `([^${char}\\\\n]+?)`\n\n  // Negative lookbehind: Ensures that the content is not followed by a space\n  const preSuffix = `(?<!\\\\s)`\n\n  // Repeats the character `amount` times\n  const suffix = `\\\\${char}`.repeat(Math.max(amount, 1))\n\n  // Negative lookahead: Ensures that the matched sequence is not followed by the same character\n  const postSuffix = `(?!\\\\${char})`\n\n  return `${prePrefix}${prefix}${postPrefix}${content}${preSuffix}${suffix}${postSuffix}`\n}\n","import type {BlockOffset, EditorContext} from '@portabletext/editor'\nimport {\n  defineBehavior,\n  effect,\n  forward,\n  raise,\n} from '@portabletext/editor/behaviors'\nimport * as selectors from '@portabletext/editor/selectors'\nimport * as utils from '@portabletext/editor/utils'\nimport {createCharacterPairRegex} from './regex.character-pair'\n\nexport function createCharacterPairDecoratorBehavior(config: {\n  decorator: ({\n    context,\n    schema,\n  }: {\n    context: Pick<EditorContext, 'schema'>\n    /**\n     * @deprecated Use `context.schema` instead\n     */\n    schema: EditorContext['schema']\n  }) => string | undefined\n  pair: {char: string; amount: number}\n  onDecorate: (offset: BlockOffset) => void\n}) {\n  if (config.pair.amount < 1) {\n    console.warn(\n      `The amount of characters in the pair should be greater than 0`,\n    )\n  }\n\n  const pairRegex = createCharacterPairRegex(\n    config.pair.char,\n    config.pair.amount,\n  )\n  const regEx = new RegExp(`(${pairRegex})$`)\n\n  return defineBehavior({\n    on: 'insert.text',\n    guard: ({snapshot, event}) => {\n      if (config.pair.amount < 1) {\n        return false\n      }\n\n      const decorator = config.decorator({\n        context: {schema: snapshot.context.schema},\n        schema: snapshot.context.schema,\n      })\n\n      if (decorator === undefined) {\n        return false\n      }\n\n      const focusTextBlock = selectors.getFocusTextBlock(snapshot)\n      const selectionStartPoint = selectors.getSelectionStartPoint(snapshot)\n      const selectionStartOffset = selectionStartPoint\n        ? utils.spanSelectionPointToBlockOffset({\n            context: snapshot.context,\n            selectionPoint: selectionStartPoint,\n          })\n        : undefined\n\n      if (!focusTextBlock || !selectionStartOffset) {\n        return false\n      }\n\n      const textBefore = selectors.getBlockTextBefore(snapshot)\n      const newText = `${textBefore}${event.text}`\n      const textToDecorate = newText.match(regEx)?.at(0)\n\n      if (textToDecorate === undefined) {\n        return false\n      }\n\n      const prefixOffsets = {\n        anchor: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar**\".length - \"**bar**\".length = 4\n          offset: newText.length - textToDecorate.length,\n        },\n        focus: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar**\".length - \"**bar**\".length + \"*\".length * 2 = 6\n          offset:\n            newText.length -\n            textToDecorate.length +\n            config.pair.char.length * config.pair.amount,\n        },\n      }\n\n      const suffixOffsets = {\n        anchor: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar*|\" (10) + \"*\".length - 2 = 9\n          offset:\n            selectionStartOffset.offset +\n            event.text.length -\n            config.pair.char.length * config.pair.amount,\n        },\n        focus: {\n          path: focusTextBlock.path,\n          // Example: \"foo **bar*|\" (10) + \"*\".length = 11\n          offset: selectionStartOffset.offset + event.text.length,\n        },\n      }\n\n      // If the prefix is more than one character, then we need to check if\n      // there is an inline object inside it\n      if (prefixOffsets.focus.offset - prefixOffsets.anchor.offset > 1) {\n        const prefixSelection = utils.blockOffsetsToSelection({\n          context: snapshot.context,\n          offsets: prefixOffsets,\n        })\n        const inlineObjectBeforePrefixFocus = selectors.getPreviousInlineObject(\n          {\n            ...snapshot,\n            context: {\n              ...snapshot.context,\n              selection: prefixSelection\n                ? {\n                    anchor: prefixSelection.focus,\n                    focus: prefixSelection.focus,\n                  }\n                : null,\n            },\n          },\n        )\n        const inlineObjectBeforePrefixFocusOffset =\n          inlineObjectBeforePrefixFocus\n            ? utils.childSelectionPointToBlockOffset({\n                context: snapshot.context,\n                selectionPoint: {\n                  path: inlineObjectBeforePrefixFocus.path,\n                  offset: 0,\n                },\n              })\n            : undefined\n\n        if (\n          inlineObjectBeforePrefixFocusOffset &&\n          inlineObjectBeforePrefixFocusOffset.offset >\n            prefixOffsets.anchor.offset &&\n          inlineObjectBeforePrefixFocusOffset.offset <\n            prefixOffsets.focus.offset\n        ) {\n          return false\n        }\n      }\n\n      // If the suffix is more than one character, then we need to check if\n      // there is an inline object inside it\n      if (suffixOffsets.focus.offset - suffixOffsets.anchor.offset > 1) {\n        const previousInlineObject = selectors.getPreviousInlineObject(snapshot)\n        const previousInlineObjectOffset = previousInlineObject\n          ? utils.childSelectionPointToBlockOffset({\n              context: snapshot.context,\n              selectionPoint: {\n                path: previousInlineObject.path,\n                offset: 0,\n              },\n            })\n          : undefined\n\n        if (\n          previousInlineObjectOffset &&\n          previousInlineObjectOffset.offset > suffixOffsets.anchor.offset &&\n          previousInlineObjectOffset.offset < suffixOffsets.focus.offset\n        ) {\n          return false\n        }\n      }\n\n      return {\n        prefixOffsets,\n        suffixOffsets,\n        decorator,\n      }\n    },\n    actions: [\n      // Insert the text as usual in its own undo step\n      ({event}) => [forward(event)],\n      (_, {prefixOffsets, suffixOffsets, decorator}) => [\n        // Decorate the text between the prefix and suffix\n        raise({\n          type: 'decorator.add',\n          decorator,\n          at: {\n            anchor: prefixOffsets.focus,\n            focus: suffixOffsets.anchor,\n          },\n        }),\n        // Delete the suffix\n        raise({\n          type: 'delete.text',\n          at: suffixOffsets,\n        }),\n        // Delete the prefix\n        raise({\n          type: 'delete.text',\n          at: prefixOffsets,\n        }),\n        // Toggle the decorator off so the next inserted text isn't emphasized\n        raise({\n          type: 'decorator.remove',\n          decorator,\n        }),\n        effect(() => {\n          config.onDecorate({\n            ...suffixOffsets.anchor,\n            offset:\n              suffixOffsets.anchor.offset -\n              (prefixOffsets.focus.offset - prefixOffsets.anchor.offset),\n          })\n        }),\n      ],\n    ],\n  })\n}\n","import type {BlockOffset, Editor, EditorContext} from '@portabletext/editor'\nimport {useEditor} from '@portabletext/editor'\nimport {\n  defineBehavior,\n  effect,\n  forward,\n  raise,\n} from '@portabletext/editor/behaviors'\nimport * as utils from '@portabletext/editor/utils'\nimport {useActorRef} from '@xstate/react'\nimport {isDeepEqual} from 'remeda'\nimport {\n  assign,\n  fromCallback,\n  setup,\n  type AnyEventObject,\n  type CallbackLogicFunction,\n} from 'xstate'\nimport {createCharacterPairDecoratorBehavior} from './behavior.character-pair-decorator'\n\n/**\n * @public\n */\nexport function CharacterPairDecoratorPlugin(props: {\n  decorator: ({\n    context,\n    schema,\n  }: {\n    context: Pick<EditorContext, 'schema'>\n    /**\n     * @deprecated Use `context.schema` instead\n     */\n    schema: EditorContext['schema']\n  }) => string | undefined\n  pair: {char: string; amount: number}\n}) {\n  const editor = useEditor()\n\n  useActorRef(decoratorPairMachine, {\n    input: {\n      editor,\n      decorator: props.decorator,\n      pair: props.pair,\n    },\n  })\n\n  return null\n}\n\ntype DecoratorPairEvent =\n  | {\n      type: 'decorator.add'\n      blockOffset: BlockOffset\n    }\n  | {\n      type: 'selection'\n      blockOffsets?: {\n        anchor: BlockOffset\n        focus: BlockOffset\n      }\n    }\n  | {\n      type: 'delete.backward'\n    }\n\nconst decorateListener: CallbackLogicFunction<\n  AnyEventObject,\n  DecoratorPairEvent,\n  {\n    decorator: ({\n      context,\n      schema,\n    }: {\n      context: Pick<EditorContext, 'schema'>\n      /**\n       * @deprecated Use `context.schema` instead\n       */\n      schema: EditorContext['schema']\n    }) => string | undefined\n    editor: Editor\n    pair: {char: string; amount: number}\n  }\n> = ({sendBack, input}) => {\n  const unregister = input.editor.registerBehavior({\n    behavior: createCharacterPairDecoratorBehavior({\n      decorator: input.decorator,\n      pair: input.pair,\n      onDecorate: (offset) => {\n        sendBack({type: 'decorator.add', blockOffset: offset})\n      },\n    }),\n  })\n\n  return unregister\n}\n\nconst selectionListenerCallback: CallbackLogicFunction<\n  AnyEventObject,\n  DecoratorPairEvent,\n  {editor: Editor}\n> = ({sendBack, input}) => {\n  const unregister = input.editor.registerBehavior({\n    behavior: defineBehavior({\n      on: 'select',\n      guard: ({snapshot, event}) => {\n        if (!event.at) {\n          return {blockOffsets: undefined}\n        }\n\n        const anchor = utils.spanSelectionPointToBlockOffset({\n          context: snapshot.context,\n          selectionPoint: event.at.anchor,\n        })\n        const focus = utils.spanSelectionPointToBlockOffset({\n          context: snapshot.context,\n          selectionPoint: event.at.focus,\n        })\n\n        if (!anchor || !focus) {\n          return {blockOffsets: undefined}\n        }\n\n        return {\n          blockOffsets: {\n            anchor,\n            focus,\n          },\n        }\n      },\n      actions: [\n        ({event}, {blockOffsets}) => [\n          {\n            type: 'effect',\n            effect: () => {\n              sendBack({type: 'selection', blockOffsets})\n            },\n          },\n          forward(event),\n        ],\n      ],\n    }),\n  })\n\n  return unregister\n}\n\nconst deleteBackwardListenerCallback: CallbackLogicFunction<\n  AnyEventObject,\n  DecoratorPairEvent,\n  {editor: Editor}\n> = ({sendBack, input}) => {\n  const unregister = input.editor.registerBehavior({\n    behavior: defineBehavior({\n      on: 'delete.backward',\n      actions: [\n        () => [\n          raise({\n            type: 'history.undo',\n          }),\n          effect(() => {\n            sendBack({type: 'delete.backward'})\n          }),\n        ],\n      ],\n    }),\n  })\n\n  return unregister\n}\n\nconst decoratorPairMachine = setup({\n  types: {\n    context: {} as {\n      decorator: ({\n        context,\n        schema,\n      }: {\n        context: Pick<EditorContext, 'schema'>\n        /**\n         * @deprecated Use `context.schema` instead\n         */\n        schema: EditorContext['schema']\n      }) => string | undefined\n      editor: Editor\n      offsetAfterDecorator?: BlockOffset\n      pair: {char: string; amount: number}\n    },\n    input: {} as {\n      decorator: ({\n        context,\n        schema,\n      }: {\n        context: Pick<EditorContext, 'schema'>\n        /**\n         * @deprecated Use `context.schema` instead\n         */\n        schema: EditorContext['schema']\n      }) => string | undefined\n      editor: Editor\n      pair: {char: string; amount: number}\n    },\n    events: {} as DecoratorPairEvent,\n  },\n  actors: {\n    'decorate listener': fromCallback(decorateListener),\n    'delete.backward listener': fromCallback(deleteBackwardListenerCallback),\n    'selection listener': fromCallback(selectionListenerCallback),\n  },\n}).createMachine({\n  id: 'decorator pair',\n  context: ({input}) => ({\n    decorator: input.decorator,\n    editor: input.editor,\n    pair: input.pair,\n  }),\n  initial: 'idle',\n  states: {\n    'idle': {\n      invoke: [\n        {\n          src: 'decorate listener',\n          input: ({context}) => ({\n            decorator: context.decorator,\n            editor: context.editor,\n            pair: context.pair,\n          }),\n        },\n      ],\n      on: {\n        'decorator.add': {\n          target: 'decorator added',\n          actions: assign({\n            offsetAfterDecorator: ({event}) => event.blockOffset,\n          }),\n        },\n      },\n    },\n    'decorator added': {\n      exit: [\n        assign({\n          offsetAfterDecorator: undefined,\n        }),\n      ],\n      invoke: [\n        {\n          src: 'selection listener',\n          input: ({context}) => ({editor: context.editor}),\n        },\n        {\n          src: 'delete.backward listener',\n          input: ({context}) => ({editor: context.editor}),\n        },\n      ],\n      on: {\n        'selection': {\n          target: 'idle',\n          guard: ({context, event}) => {\n            const selectionChanged = !isDeepEqual(\n              {\n                anchor: context.offsetAfterDecorator,\n                focus: context.offsetAfterDecorator,\n              },\n              event.blockOffsets,\n            )\n\n            return selectionChanged\n          },\n        },\n        'delete.backward': {\n          target: 'idle',\n        },\n      },\n    },\n  },\n})\n"],"names":["createCharacterPairRegex","char","amount","prePrefix","prefix","repeat","Math","max","postPrefix","content","preSuffix","suffix","postSuffix","createCharacterPairDecoratorBehavior","config","pair","console","warn","pairRegex","regEx","RegExp","defineBehavior","on","guard","snapshot","event","decorator","context","schema","undefined","focusTextBlock","selectors","getFocusTextBlock","selectionStartPoint","getSelectionStartPoint","selectionStartOffset","utils","spanSelectionPointToBlockOffset","selectionPoint","newText","getBlockTextBefore","text","textToDecorate","match","at","prefixOffsets","anchor","path","offset","length","focus","suffixOffsets","prefixSelection","blockOffsetsToSelection","offsets","inlineObjectBeforePrefixFocus","getPreviousInlineObject","selection","inlineObjectBeforePrefixFocusOffset","childSelectionPointToBlockOffset","previousInlineObject","previousInlineObjectOffset","actions","forward","_","raise","type","effect","onDecorate","CharacterPairDecoratorPlugin","props","$","_c","editor","useEditor","t0","input","useActorRef","decoratorPairMachine","decorateListener","sendBack","registerBehavior","behavior","blockOffset","selectionListenerCallback","blockOffsets","deleteBackwardListenerCallback","setup","types","events","actors","fromCallback","createMachine","id","initial","states","invoke","src","target","assign","offsetAfterDecorator","exit","isDeepEqual"],"mappings":"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"}